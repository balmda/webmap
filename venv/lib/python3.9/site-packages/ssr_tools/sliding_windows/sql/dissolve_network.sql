DROP TABLE IF EXISTS {output_schema}.dissolved_network;
CREATE TABLE {output_schema}.dissolved_network AS (
    SELECT
        (ST_DUMP(ST_LineMerge(ST_Union(r.{network_geom})))).geom AS {network_geom},
        {dissolved_network_fields}
    FROM {network_schema}.{network} r 
    {where_if} {where_clause}
    GROUP BY {dissolved_network_fields}
);

CREATE INDEX IF NOT EXISTS sidx_dissolved_network_geom ON {output_schema}.dissolved_network USING GIST({network_geom});
ANALYSE {output_schema}.dissolved_network({network_geom});

ALTER TABLE {output_schema}.dissolved_network ADD COLUMN IF NOT EXISTS _length FLOAT;

UPDATE {output_schema}.dissolved_network
SET _length = ST_LENGTH({network_geom})
;

CREATE INDEX IF NOT EXISTS idx_dissolved_network_length ON {output_schema}.dissolved_network(_length);
ANALYSE {output_schema}.dissolved_network(_length);