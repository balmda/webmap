from ssr_tools.sliding_windows.sliding_windows import SlidingWindows
from ssr_tools.dbutils.dbutils import * 

x = SlidingWindows(
        study_name='testing', 
        crash_table='p010.windows_crashes_tmp', 
        network_table='p010.received_segments', 
        crash_geom='geom', 
        network_geom='geom',
        output_schema='p010', 
        verbose=True,
        db_name='ssrc01'
        )

x.make_windows(
        dissolve_col='stname_ord', 
        window_length=5280, 
        step_length=5280*0.1
        )

x.prep_crash_data(
        mode_col='mode_simple', 
        sev_col='severitydesc'
        )

ksi_weights={
    'Fatality_Collision':3,
    'Serious_Injury_Collision':3,
    'Injury_Collision':1,
    'Property_Damage_Only_Collision':1,
    'Unknown':0
    }

x.run_sliding_window_analysis(
    weights=ksi_weights,
    search_distance=100
    )

mode_col_list = ['bike', 'ped', 'mv']
for m in mode_col_list:
    tmp = [m + '_' + x  + ' * ' + str(ksi_weights[x]) for x in ksi_weights]