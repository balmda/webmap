-- Drop Intersections based on number of legs
ALTER TABLE {int_out_schema}.{int_table} ADD COLUMN IF NOT EXISTS leg_cnt INT; 

UPDATE {int_out_schema}.{int_table} a 
SET leg_cnt = (
    SELECT 
        COUNT(DISTINCT b.{road_pkey})
    FROM {road_schema}.{road} b 
    WHERE ST_DWithin(a.{int_geom}, b.{road_geom}, {tolerance}) 
); 

DELETE FROM {int_out_schema}.{int_table}
WHERE leg_cnt <= {min_legs}
;